# Critical Section ⭐

멀티 쓰레드(프로세스 환경에서) 공유 자원에 대한 동기화는 항상 고민해야하는 문제중 하나다.

공유자원을 다루기 위해서는 임계구역 in,out 처리를 확실히 해야한다. 스레드(프로세스)의 임계구역 처리 방법에는 대표적으로 3가지가 있다. 

---

## 1. 스핀락(spin lock, busy-waiting)

    wait(S) {
    while (S <= 0);  // 자원이 없다면 while 루프를 돌며 대기를 함.
    S--;  // 자원을 획득함.
    }
    signal(S) {
    S++;  // 자원을 해제함.
    }
    
wait() 의 구역은 cpu의 관리에 의해 단 하나의 스레드(프로세스)만 들어갈수있다. 처음에 wait에 들어가서 자원을 얻을 때까지 while문을 탈출하지 못한다.

cpu 하나(코어)를 점유하고 계속해서 임계영역에 들어가길 시도하기때문에 심각한 낭비가 일어날 수 있다. 그래서 사실상 멀티코어 환경에서만 시도할수 있다.

다만 스핀락이 좋은 경우가 있다면, 컨텍스트 스위치 비용이 적기 때문에 스레드(프로세스)의 작업이 빨리 끝나는 경우에는 효율적인 결과를 보여줄수 있다.

---

## 2. 뮤텍스(Mutex)

#### 동시 프로그래밍에서 공유 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘


    do {
      wait (mutex);

      // Critical section
      signal (mutex);

    // Remainder section
    } while (TRUE);


뮤텍스는 cpu가 낭비되는 스핀락의 무한루프를 보완하고자 나온 방법으로 무한루프에 들어가는것이 아닌, 하나의 스레드(프로세스)가 이미 점유하고 있다면(락을 누가 이미 사용중) 

대기 큐에 sleep모드로 들어가는것이다. 이후 락을 얻을수 있는 상태가 된다면, 대기큐의 맨앞 스레드(프로세스)가 wake-up하면서 락을 얻는다.

---

## 3. 세마포어(semaphore)

#### 멀티 프로그래밍 환경에서 공유된 자원에 대한 접근을 제한하는 방법 

<img width="709" alt="스크린샷 2023-07-21 오후 2 13 27" src="https://github.com/YongNyeo/TIL/assets/109174778/ac661cf3-9542-4e3a-b7ba-5f55a8a8ecda">

이용할 수 있는 방(락)이 있고 입구에 전광판(잔여 락 개수)를 둔다. 락을 이용할 수 있는 경우에만 스레드(프로세스)가 락을 얻게 되고 임계구역에 들어가게 된다.

만약 공유 자원의 수가 1개일 때는 이진-세마포어, 뮤텍스와 같이 동작한다. 

---

### ✈️ Plus
- 세마포어는 주로 시스템적 범위에 적용이 되며 뮤텍스는 프로세스 내에서 적용이 된다. (물론 세마포어와 뮤텍스는 매커니즘의 개념이기 때문에 국한된다고 할 수는 없다.)
- 주로 뮤텍스는 프로세스 내 쓰레드간 자원 접근에 대하여 적용이 되며 Lock 한 쓰레드가 Unlock 도 해주어야 한다.

------

📘 Reference
- [링크1](https://medium.com/@kwoncharles/%EB%AE%A4%ED%85%8D%EC%8A%A4-mutex-%EC%99%80-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4-semaphore-%EC%9D%98-%EC%B0%A8%EC%9D%B4-de6078d3c453)
- [링크2](https://chelseashin.tistory.com/40)

