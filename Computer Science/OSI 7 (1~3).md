# OSI 7계층 and TPC/IP 4계층

### ❓ 우선 이 계층이 왜 나누었고 왜 배워야하는지 먼저 알아야한다.

컴퓨터와 컴퓨터간 , 서버와 클라이언트끼리의 데이터를 주고 받는데 그냥 컴퓨터만 딱 두대 있다고 보내지는가? 아니다

<img width="738" alt="스크린샷 2023-07-29 오후 2 33 25" src="https://github.com/YongNyeo/TIL/assets/109174778/ce61784f-d0cd-4a76-b305-43406f6da074">

전선도 있어야하고, 공유기도 있어야하고.. 여러가지가 필요한데  그 연결과정을 단계(계층)별로 나누고 정의한 것이 OSI 7계층이다.

TCP/IP 4계층은 OSI 7계층을 좀더 정리해서 나온 현대판 OSI 계층이라고 볼 수 있다.

![998660345D6BC86E28](https://github.com/YongNyeo/TIL/assets/109174778/9f1f3a0c-8b85-4406-92d0-331771d45fd9)

---

# 1. 물리 계층

컴퓨터는 0과 1로 이루어진 디지털 데이터인데 이것을 어떻게 상대 컴퓨터에 보낼것인가?

결국엔 컴퓨터끼리 데이터를 주고 받으려면 항상 '전선'이 필요하다. 그리고 대부분의 전선은 아날로그 신호 통신으로 이뤄진다.  왜?

<img width="503" alt="스크린샷 2023-07-29 오후 2 39 02" src="https://github.com/YongNyeo/TIL/assets/109174778/da631d99-a3b3-4e7d-b2e7-7dd22998cd33">

- 아날로그 신호는 부드러운 곡선을 갖는 반면, 디지털 신호는 딱딱 떨어지는 양상을 보인다. 

- 문제점은 전선 상의 잡음과 왜곡으로 인해 신호가 손실될 수 있고, 장거리 통신에서는 신호의 감쇄가 될수있다는 것이다.

- 그래서 보통 전선(유선,무선)을 보낼때는 아날로그 신호를 통해 보내는 것이다.

<img width="359" alt="스크린샷 2023-07-29 오후 2 31 53" src="https://github.com/YongNyeo/TIL/assets/109174778/90789e8e-51d8-44db-a16d-1ab9049d0ba7">

### 랜카드
- 이 디지털 신호를 바꿔주는것은 '랜카드'(하드웨어)가 한다. 컴퓨터 본체 뒷부분을 보면 (외장)랜카드꽂는 부분이 있고 요즘은 메인보드에 내장된상태인 내장랜카드로 나온다.

- 유선 랜카드는 유선랜선과 연결할 수 있도록 도와주고 무선 랜카드는 무선 공유기와 연결할 수 있도록 도와준다. 

- 보통 데스크탑에서 무선 와이파이가 안되는 이유가 무선 랜카드가 없고, 유선 랜카드만 있기 때문에 외장 무선 랜카드를 써서 연결한다.
  
---

이 과정에서 데이터를 더 다양하게 공유할 수 있는 '허브'와 전송 중 약해지는 전기 신호를 증폭시켜주는 '리피터'가 있다.

<img width="439" alt="스크린샷 2023-07-29 오후 2 46 33" src="https://github.com/YongNyeo/TIL/assets/109174778/a0728a7f-d120-4146-ae53-cdd32ac00183">

### 허브,리피터

- 허브는 그림과 같이 더 많은 경로로 신호를 보내줄수 있게 된다. 우리가 인터넷으로 수많은 정보를 주고받고 할수 있는 이유가 이 기능때문이다.
  
- 허브는 서로 다른 기기들간의 메시지,신호의 충돌 위험때문에 대부분 스위치로 대체된다.(스위치는 2계층에서 정리한다)

- 여기에 수많은 케이블이 이어지면서 자칫 약해질수 있는 신호를 '리피터'를 통해 증폭시켜 문제점을 해결할수 있다.

여기까지 개념으로 우리는 컴퓨터 디지털 데이터를 아날로그 데이터로 바꿔서 전선을 통해 상대 컴퓨터로 넘어갈 수 있다는 것을 알 수 있다.

---

# 2. 데이터링크 계층

데이터링크 계층은 물리계층과 연관되어있다.

![image](https://github.com/YongNyeo/TIL/assets/109174778/8d0dfab2-c25d-4cbc-9f75-3df7839b06ec)

물리계층에서 설명한 모든 랜카드에는 컴퓨터마다 고유ID인 MAC주소가 할당되어있다. 절대로 중복될수 없다.

---
## 스위치

2계층에선 스위치가 대부분의 역할을 담당한다.

스위치에는 허브와 중요한 차이점 몇가지 있다.

- 허브는 특정 기기에 송신을 하고싶은 상황이어도 모두에게 보내야한다. 이런 상황에선 충돌가능성도 높아지는데 충돌제어 기능이 없다.
- 반면 스위치에는 각 컴퓨터가 어떤 컴퓨터인지 mac주소를 저장한 mac테이블이 존재한다.
- 스위치는 회선 제어/오류 제어 기능을 통해 신호간의 충돌을 방지할수 있다.
  - 1:1 방식 - ENQ/ACK 신호를 주고 받는 과정이다.
  - 1:N 방식 - polling이라고도 부른다.
  
---

## 연결된 기기들의 mac주소는 어떻게?
<img width="655" alt="스크린샷 2023-07-29 오후 3 20 31" src="https://github.com/YongNyeo/TIL/assets/109174778/678fc35d-4a63-42e8-8928-da6b17585a8b">

이때 사용하는것이 데이터링크 계층의 프로토콜중 ARP라는것을 이용한다. 

ARP프로토콜은  IP 주소를 이용해 MAC주소를 알아내준다. 

IP주소는 3계층에서 2계층으로 내려올때 출발IP,도착IP 정보를 가지고 내려오기 때문에 2계층에선 갖고있는것이 정상이다.

이렇게 스위치를 통해 각 기기들이 주고받는 하나의 단위를 Frame(데이터링크 계층)이라 한다.

<img width="755" alt="스크린샷 2023-07-29 오후 3 18 01" src="https://github.com/YongNyeo/TIL/assets/109174778/6bbac474-125f-469c-ae00-4c18c4c7f00a">

저 안에 아까 말한 송/수신 mac주소, 오류/회선 제어 기능, 상위 계층에서 사용된 캡슐화된 패킷 등의 정보들이 담겨있다.

여기까지 과정을 통해서 스위치에 연결된 기기들끼리는 원하는 데이터를 자유롭게 보낼 수 있다.

하지만 다른 스위치,다른 네트워크에 있는 기기들과 데이터를 주고받으려면 뭔가 더 확장시켜야 한다는 느낌을 받을것이다.

---

# 3. 네트워크 계층

<img width="307" alt="스크린샷 2023-07-29 오후 3 32 29" src="https://github.com/YongNyeo/TIL/assets/109174778/af21c411-1b70-44a3-b45e-6c0e274ccf05">

지금 하고싶은건 스위치를 넘어선 다른 네트워크와의 통신이다.

스위치를 계속 연결하는건 물리적으로 한계가 있다 이때 이용하는 3계층 장비가 '라우터'다.  

라우터는 네트워크망에서 데이터를 주고 받고 도와준다. 라우터 안에는 '라우팅 테이블'이라고 해서 연결된 라우터,ip주소들이 등록되어있다. 따라서 보내고자하는 ip를 안다면 라우터가 포워딩을 통해 찾아준다.

<img width="797" alt="스크린샷 2023-07-29 오후 3 46 15" src="https://github.com/YongNyeo/TIL/assets/109174778/c3e7748f-6365-467b-8242-4aeb6133d044">

그림과 같이 수많은 중계 라우터를(그림상 노드) 통해 내가 원하고자 하는 서버에 도달할 수 있다.

--- 

## 라우팅 vs 포워딩

- 포워딩은 라우터로 들어온 패킷의 헤더를 검사하여 IP 주소를 확인하고, 포워딩 테이블의 IP 주소와 비교하여 어디로 보내줄지를 정해주는 과정이다. 
- 라우팅은 패킷의 출발부터 도착까지의 전체 일정을 관리하는 일이라면, 포워딩은 바로 다음 목적지로 보내주는 과정이다. 
- 라우팅은 소프트웨어가, 포워딩은 하드웨어가 담당한다.

---

## 수신자ip는 어떻게 얻지? 답은 DNS 에 있다.

DNS 프로토콜은 사실 7계층 프로토콜이지만 이해를 돕고자 지금 설명한다.

- 도메인주소를(www.google.com, www.naver.com) 알면 ip주소를 넘겨주는 프로토콜이다. 도메인 주소를 담당하는 도메인 서버가 따로 존재한다.
 
- 그래서 우리는 수신자의 ip를 알고 라우터에 넘겨줄 수 있다. 


<img width="576" alt="스크린샷 2023-07-29 오후 3 52 29" src="https://github.com/YongNyeo/TIL/assets/109174778/77312022-aca0-4287-9a63-9861b2eb334d">

3계층에서 주고받는 데이터 단위는 '패킷'이라고 한다.  

패킷 내에는
- 패킷의 전송 우선순위, 버전, 헤더 크기, 패킷 전체 크기(길이)
- Flag(분열) , TTL(생존 시간), 체크섬(오류검사) , 출발-도착 ip주소 등이 있다.
